<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>State machine: nestedTest.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">State machine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">nestedTest.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Simple example testing the behaviour of nested parent states</p>
<div class="fragment"><div class="line"><span class="comment">/* </span></div>
<div class="line"><span class="comment"> * Copyright (c) 2013 Andreas Misje</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a</span></div>
<div class="line"><span class="comment"> * copy of this software and associated documentation files (the &quot;Software&quot;),</span></div>
<div class="line"><span class="comment"> * to deal in the Software without restriction, including without limitation</span></div>
<div class="line"><span class="comment"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</span></div>
<div class="line"><span class="comment"> * and/or sell copies of the Software, and to permit persons to whom the</span></div>
<div class="line"><span class="comment"> * Software is furnished to do so, subject to the following conditions:</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * The above copyright notice and this permission notice shall be included in</span></div>
<div class="line"><span class="comment"> * all copies or substantial portions of the Software.</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></div>
<div class="line"><span class="comment"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></div>
<div class="line"><span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></div>
<div class="line"><span class="comment"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></div>
<div class="line"><span class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span></div>
<div class="line"><span class="comment"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span></div>
<div class="line"><span class="comment"> * DEALINGS IN THE SOFTWARE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="stateMachine_8h.html">stateMachine.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* This simple test uses a multiple-nested state machine to test that</span></div>
<div class="line"><span class="comment"> * traversing parents anc children work correctly.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     +--+         o</span></div>
<div class="line"><span class="comment"> *     |  v         |</span></div>
<div class="line"><span class="comment"> * +---|------[9]---|----------+</span></div>
<div class="line"><span class="comment"> * |   |            v          |</span></div>
<div class="line"><span class="comment"> * |   |   o      +---+   (b)  |  +---+</span></div>
<div class="line"><span class="comment"> * |   |   |      | 1 |&lt;----------| 2 |&lt;---+</span></div>
<div class="line"><span class="comment"> * |   |   |      +---+        |  +---+&lt;-+ |</span></div>
<div class="line"><span class="comment"> * |   |   |        |(d)       |         | |</span></div>
<div class="line"><span class="comment"> * | +-|---|--[10]--|--------+ |         | |</span></div>
<div class="line"><span class="comment"> * | | |   |        v        | |      (f)| |(g)</span></div>
<div class="line"><span class="comment"> * | | o   |      +---+&lt;----------+      | |</span></div>
<div class="line"><span class="comment"> * | |     |      | 3 |-+    | |  |(a)   | |</span></div>
<div class="line"><span class="comment"> * | |     |      +---+ |(e) | +--+      | |</span></div>
<div class="line"><span class="comment"> * | |     |            v    | |         | |</span></div>
<div class="line"><span class="comment"> * | | +---|----[11]-------+ +-----------+ |</span></div>
<div class="line"><span class="comment"> * | | |   v             o +---------------+</span></div>
<div class="line"><span class="comment"> * | | | +---+ (h)+---+  | | | |</span></div>
<div class="line"><span class="comment"> * | | | | 4 |---&gt;| 5 |&lt;-+ | | |  +---+</span></div>
<div class="line"><span class="comment"> * | | | +---+    +---+    | | |  | 6 |</span></div>
<div class="line"><span class="comment"> * | | |   |(j)     |      | | |  +---+</span></div>
<div class="line"><span class="comment"> * | | |   |        |      | | |    ^</span></div>
<div class="line"><span class="comment"> * | | +---|--------|------+ +------+(i)</span></div>
<div class="line"><span class="comment"> * | +-----|--------|--------+ |</span></div>
<div class="line"><span class="comment"> * +-------|-----^--|----------+           +---+</span></div>
<div class="line"><span class="comment"> *      ^  |     |  |                      | E |</span></div>
<div class="line"><span class="comment"> *      +--+     +--+                      +---+</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">enum</span> eventTypes</div>
<div class="line">{</div>
<div class="line">   Event_dummy,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Use this struct as event payload, containing both the event data (a single</span></div>
<div class="line"><span class="comment"> * character) and the name of the expected new state (used to ensure correct</span></div>
<div class="line"><span class="comment"> * behaviour).  */</span></div>
<div class="line"><span class="keyword">struct </span>eventPayload</div>
<div class="line">{</div>
<div class="line">   <span class="keywordtype">char</span> data;</div>
<div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span> *expectedState;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> entryAction( <span class="keywordtype">void</span> *stateData, <span class="keyword">struct</span> <a name="_a0"></a><a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> *<a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> );</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> exitAction( <span class="keywordtype">void</span> *stateData, <span class="keyword">struct</span> <a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> *<a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> );</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> transAction( <span class="keywordtype">void</span> *oldStateData, <span class="keyword">struct</span> <a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> *<a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a>,</div>
<div class="line">      <span class="keywordtype">void</span> *newStateData );</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> guard( <span class="keywordtype">void</span> *condition, <span class="keyword">struct</span> <a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> *<a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> );</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a name="_a1"></a><a class="code" href="structstate.html" title="State.">state</a> s1, s2, s3, s4, s5, s6, s9, s10, s11, sE;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structstate.html" title="State.">state</a></div>
<div class="line"></div>
<div class="line">s1 =</div>
<div class="line">{</div>
<div class="line">   .<a name="a2"></a><a class="code" href="structstate.html#ac24b7cde82b081ecd942a95ffa3a97c1" title="Data that will be available for the state in its entryAction and exitAction, and in any transition ac...">data</a> = <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">   .entryAction = &amp;<a name="a3"></a><a class="code" href="structstate.html#afe3c84c80918f03f996c3b2b0ef4247b" title="This function is called whenever the state is being entered. May be NULL.">entryAction</a>,</div>
<div class="line">   .exitAction = &amp;<a name="a4"></a><a class="code" href="structstate.html#a08e403e4d5e93e3f04635baef25b10ed" title="This function is called whenever the state is being left. May be NULL.">exitAction</a>,</div>
<div class="line">   .transitions = (<span class="keyword">struct </span><a name="_a5"></a><a class="code" href="structtransition.html" title="Transition between a state and another state.">transition</a>[]) {</div>
<div class="line">      { Event_dummy, (<span class="keywordtype">void</span> *)(intptr_t)<span class="charliteral">&#39;d&#39;</span>, &amp;<a name="a6"></a><a class="code" href="structtransition.html#aaed7ffe8b4bb6ef95c8189331ec877ce" title="Check if data passed with event fulfils a condition.">guard</a>, &amp;transAction, &amp;s3 },</div>
<div class="line">   },</div>
<div class="line">   .numTransitions = 1,</div>
<div class="line">   .parentState = &amp;s9,</div>
<div class="line">},</div>
<div class="line"></div>
<div class="line">   s2 =</div>
<div class="line">{</div>
<div class="line">   .data = <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">   .entryAction = &amp;entryAction,</div>
<div class="line">   .exitAction = &amp;exitAction,</div>
<div class="line">   .transitions = (<span class="keyword">struct </span><a class="code" href="structtransition.html" title="Transition between a state and another state.">transition</a>[]) {</div>
<div class="line">      { Event_dummy, (<span class="keywordtype">void</span> *)(intptr_t)<span class="charliteral">&#39;b&#39;</span>, &amp;<a class="code" href="structtransition.html#aaed7ffe8b4bb6ef95c8189331ec877ce" title="Check if data passed with event fulfils a condition.">guard</a>, &amp;transAction, &amp;s1 },</div>
<div class="line">   },</div>
<div class="line">   .<a name="a7"></a><a class="code" href="structstate.html#aaa0824f72f5ad78d17bd9ec2480fbd3a" title="Number of transitions in the transitions array.">numTransitions</a> = 1,</div>
<div class="line">},</div>
<div class="line"></div>
<div class="line">   s3 =</div>
<div class="line">{</div>
<div class="line">   .data = <span class="stringliteral">&quot;3&quot;</span>,</div>
<div class="line">   .entryAction = &amp;entryAction,</div>
<div class="line">   .exitAction = &amp;exitAction,</div>
<div class="line">   .transitions = (<span class="keyword">struct </span><a class="code" href="structtransition.html" title="Transition between a state and another state.">transition</a>[]) {</div>
<div class="line">      { Event_dummy, (<span class="keywordtype">void</span> *)(intptr_t)<span class="charliteral">&#39;e&#39;</span>, &amp;<a class="code" href="structtransition.html#aaed7ffe8b4bb6ef95c8189331ec877ce" title="Check if data passed with event fulfils a condition.">guard</a>, &amp;transAction, &amp;s11 },</div>
<div class="line">   },</div>
<div class="line">   .numTransitions = 1,</div>
<div class="line">   .parentState = &amp;s10,</div>
<div class="line">},</div>
<div class="line"></div>
<div class="line">   s4 =</div>
<div class="line">{</div>
<div class="line">   .data = <span class="stringliteral">&quot;4&quot;</span>,</div>
<div class="line">   .entryAction = &amp;entryAction,</div>
<div class="line">   .exitAction = &amp;exitAction,</div>
<div class="line">   .transitions = (<span class="keyword">struct </span><a class="code" href="structtransition.html" title="Transition between a state and another state.">transition</a>[]) {</div>
<div class="line">      { Event_dummy, (<span class="keywordtype">void</span> *)(intptr_t)<span class="charliteral">&#39;h&#39;</span>, &amp;<a class="code" href="structtransition.html#aaed7ffe8b4bb6ef95c8189331ec877ce" title="Check if data passed with event fulfils a condition.">guard</a>, &amp;transAction, &amp;s5 },</div>
<div class="line">      { Event_dummy, (<span class="keywordtype">void</span> *)(intptr_t)<span class="charliteral">&#39;j&#39;</span>, &amp;<a class="code" href="structtransition.html#aaed7ffe8b4bb6ef95c8189331ec877ce" title="Check if data passed with event fulfils a condition.">guard</a>, &amp;transAction, &amp;s9 },</div>
<div class="line">   },</div>
<div class="line">   .numTransitions = 2,</div>
<div class="line">   .parentState = &amp;s11,</div>
<div class="line">},</div>
<div class="line"></div>
<div class="line">   s5 =</div>
<div class="line">{</div>
<div class="line">   .data = <span class="stringliteral">&quot;5&quot;</span>,</div>
<div class="line">   .entryAction = &amp;entryAction,</div>
<div class="line">   .exitAction = &amp;exitAction,</div>
<div class="line">   .transitions = (<span class="keyword">struct </span><a class="code" href="structtransition.html" title="Transition between a state and another state.">transition</a>[]) {</div>
<div class="line">      <span class="comment">/* Use an conditionless transition: */</span></div>
<div class="line">      { Event_dummy, NULL, NULL, &amp;transAction, &amp;s10 },</div>
<div class="line">   },</div>
<div class="line">   .numTransitions = 1,</div>
<div class="line">   .parentState = &amp;s11,</div>
<div class="line">},</div>
<div class="line"></div>
<div class="line">   s6 =</div>
<div class="line">{</div>
<div class="line">   .data = <span class="stringliteral">&quot;6&quot;</span>,</div>
<div class="line">   .entryAction = &amp;entryAction,</div>
<div class="line">   .exitAction = &amp;exitAction,</div>
<div class="line">},</div>
<div class="line"></div>
<div class="line">   s9 =</div>
<div class="line">{</div>
<div class="line">   .data = <span class="stringliteral">&quot;9&quot;</span>,</div>
<div class="line">   .entryAction = &amp;entryAction,</div>
<div class="line">   .exitAction = &amp;exitAction,</div>
<div class="line">   .entryState = &amp;s4,</div>
<div class="line">   .transitions = (<span class="keyword">struct </span><a class="code" href="structtransition.html" title="Transition between a state and another state.">transition</a>[]) {</div>
<div class="line">      { Event_dummy, (<span class="keywordtype">void</span> *)(intptr_t)<span class="charliteral">&#39;a&#39;</span>, &amp;<a class="code" href="structtransition.html#aaed7ffe8b4bb6ef95c8189331ec877ce" title="Check if data passed with event fulfils a condition.">guard</a>, &amp;transAction, &amp;s3 },</div>
<div class="line">   },</div>
<div class="line">   .numTransitions = 1,</div>
<div class="line">},</div>
<div class="line"></div>
<div class="line">   s10 =</div>
<div class="line">{</div>
<div class="line">   .data = <span class="stringliteral">&quot;10&quot;</span>,</div>
<div class="line">   .entryAction = &amp;entryAction,</div>
<div class="line">   .exitAction = &amp;exitAction,</div>
<div class="line">   .entryState = &amp;s9,</div>
<div class="line">   .transitions = (<span class="keyword">struct </span><a class="code" href="structtransition.html" title="Transition between a state and another state.">transition</a>[]) {</div>
<div class="line">      { Event_dummy, (<span class="keywordtype">void</span> *)(intptr_t)<span class="charliteral">&#39;f&#39;</span>, &amp;<a class="code" href="structtransition.html#aaed7ffe8b4bb6ef95c8189331ec877ce" title="Check if data passed with event fulfils a condition.">guard</a>, &amp;transAction, &amp;s2 },</div>
<div class="line">      { Event_dummy, (<span class="keywordtype">void</span> *)(intptr_t)<span class="charliteral">&#39;i&#39;</span>, &amp;<a class="code" href="structtransition.html#aaed7ffe8b4bb6ef95c8189331ec877ce" title="Check if data passed with event fulfils a condition.">guard</a>, &amp;transAction, &amp;s6 },</div>
<div class="line">   },</div>
<div class="line">   .numTransitions = 2,</div>
<div class="line">   .parentState = &amp;s9,</div>
<div class="line">},</div>
<div class="line"></div>
<div class="line">   s11 =</div>
<div class="line">{</div>
<div class="line">   .data = <span class="stringliteral">&quot;11&quot;</span>,</div>
<div class="line">   .entryAction = &amp;entryAction,</div>
<div class="line">   .exitAction = &amp;exitAction,</div>
<div class="line">   .entryState = &amp;s5,</div>
<div class="line">   .transitions = (<span class="keyword">struct </span><a class="code" href="structtransition.html" title="Transition between a state and another state.">transition</a>[]) {</div>
<div class="line">      { Event_dummy, (<span class="keywordtype">void</span> *)(intptr_t)<span class="charliteral">&#39;g&#39;</span>, &amp;<a class="code" href="structtransition.html#aaed7ffe8b4bb6ef95c8189331ec877ce" title="Check if data passed with event fulfils a condition.">guard</a>, &amp;transAction, &amp;s2 },</div>
<div class="line">   },</div>
<div class="line">   .numTransitions = 1,</div>
<div class="line">   .parentState = &amp;s10,</div>
<div class="line">},</div>
<div class="line"></div>
<div class="line">   sE =</div>
<div class="line">{</div>
<div class="line">   .data = <span class="stringliteral">&quot;ERROR&quot;</span>,</div>
<div class="line">   .entryAction = &amp;entryAction,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">struct </span><a name="_a8"></a><a class="code" href="group__stateMachine.html#structstateMachine" title="State machine.">stateMachine</a> fsm;</div>
<div class="line">   <a name="a9"></a><a class="code" href="group__stateMachine.html#ga268b32465e5fc5c29873382e2c21dc34" title="Initialise the state machine.">stateM_init</a>( &amp;fsm, &amp;s1, &amp;sE );</div>
<div class="line"></div>
<div class="line">   <span class="keyword">struct </span><a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> events[] = {</div>
<div class="line">      <span class="comment">/* Create transitions, with the single character as triggering event</span></div>
<div class="line"><span class="comment">       * data, and the expected new state name as the following string. &#39;*&#39; is</span></div>
<div class="line"><span class="comment">       * used when the unconditional transition will be followed. */</span></div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;d&#39;</span>, <span class="stringliteral">&quot;3&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;e&#39;</span>, <span class="stringliteral">&quot;5&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;*&#39;</span>, <span class="stringliteral">&quot;4&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;j&#39;</span>, <span class="stringliteral">&quot;4&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;g&#39;</span>, <span class="stringliteral">&quot;2&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;b&#39;</span>, <span class="stringliteral">&quot;1&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;d&#39;</span>, <span class="stringliteral">&quot;3&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;e&#39;</span>, <span class="stringliteral">&quot;5&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;k&#39;</span>, <span class="stringliteral">&quot;4&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;h&#39;</span>, <span class="stringliteral">&quot;5&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;*&#39;</span>, <span class="stringliteral">&quot;4&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;f&#39;</span>, <span class="stringliteral">&quot;2&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;b&#39;</span>, <span class="stringliteral">&quot;1&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;a&#39;</span>, <span class="stringliteral">&quot;3&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;f&#39;</span>, <span class="stringliteral">&quot;2&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;b&#39;</span>, <span class="stringliteral">&quot;1&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;d&#39;</span>, <span class="stringliteral">&quot;3&quot;</span> } },</div>
<div class="line">      { Event_dummy, &amp;(<span class="keyword">struct </span>eventPayload){ <span class="charliteral">&#39;i&#39;</span>, <span class="stringliteral">&quot;6&quot;</span> } },</div>
<div class="line">   };</div>
<div class="line"></div>
<div class="line">   <span class="keywordtype">int</span> res;</div>
<div class="line">   <span class="keywordtype">size_t</span> i;</div>
<div class="line"></div>
<div class="line">   <span class="comment">/* Hand all but the last event to the state machine: */</span></div>
<div class="line">   <span class="keywordflow">for</span> ( i = 0; i &lt; <span class="keyword">sizeof</span>( events ) / <span class="keyword">sizeof</span>( events[ 0 ] ) - 1; ++i )</div>
<div class="line">   {</div>
<div class="line">      res = <a name="a10"></a><a class="code" href="group__stateMachine.html#ga1633db5849b6b1a9837227a5aa754008" title="Pass an event to the state machine.">stateM_handleEvent</a>( &amp;fsm, &amp;events[ i ] );</div>
<div class="line">      <span class="keywordflow">if</span> ( res == <a name="a11"></a><a class="code" href="group__stateMachine.html#ggad29739ed2b2edf3691ea54dcf9dfa7cca28a37d28fb17a67e5fc74f165e7de2ce" title="The state changed back to itself.">stateM_stateLoopSelf</a> )</div>
<div class="line">      {</div>
<div class="line">         <span class="comment">/* Prevent segmentation faults (due to the following comparison)</span></div>
<div class="line"><span class="comment">          * (loops will not be tested in the first transition): */</span></div>
<div class="line">         <span class="keywordflow">if</span> ( i == 0 )</div>
<div class="line">         {</div>
<div class="line">            fputs( <span class="stringliteral">&quot;Internal error. This should not happen.\n&quot;</span>, stderr );</div>
<div class="line">            exit( 4 );</div>
<div class="line">         }</div>
<div class="line"></div>
<div class="line">         <span class="comment">/* Ensure that the reported state loop is indeed a state loop (check</span></div>
<div class="line"><span class="comment">          * that the expected state is the same as the previous expected</span></div>
<div class="line"><span class="comment">          * state): */</span></div>
<div class="line">         <span class="keywordflow">if</span> ( !strcmp( ( (<span class="keyword">struct</span> eventPayload *)events[ i ].data</div>
<div class="line">                     )-&gt;expectedState, ((<span class="keyword">struct</span> eventPayload *)events[ i - 1 ]</div>
<div class="line">                        .data )-&gt;expectedState ) )</div>
<div class="line">            puts( <span class="stringliteral">&quot;State changed back to itself&quot;</span> );</div>
<div class="line">         <span class="keywordflow">else</span></div>
<div class="line">         {</div>
<div class="line">            fputs( <span class="stringliteral">&quot;State unexpectedly changed back to itself&quot;</span>, stderr );</div>
<div class="line">            exit( 5 );</div>
<div class="line">         }</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">/* Apart from an occasional state loop, all other events handed to the</span></div>
<div class="line"><span class="comment">       * state machine should result in &#39;stateM_stateChanged&#39;: */</span></div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( res != <a name="a12"></a><a class="code" href="group__stateMachine.html#ggad29739ed2b2edf3691ea54dcf9dfa7cca7f599b1959a12bd71458256fd6cd329c" title="The current state changed into a non-final state.">stateM_stateChanged</a> )</div>
<div class="line">      {</div>
<div class="line">         fprintf( stderr, <span class="stringliteral">&quot;Unexpected return value from stateM_handleEvent:&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot; %d\n&quot;</span>, res );</div>
<div class="line">         exit( 2 );</div>
<div class="line">      }</div>
<div class="line">   }</div>
<div class="line"></div>
<div class="line">   <span class="comment">/* The last state change is expected to result in a transition to a final</span></div>
<div class="line"><span class="comment">    * state: */</span></div>
<div class="line">   res = <a class="code" href="group__stateMachine.html#ga1633db5849b6b1a9837227a5aa754008" title="Pass an event to the state machine.">stateM_handleEvent</a>( &amp;fsm, &amp;events[ i ] );</div>
<div class="line">   <span class="keywordflow">if</span> ( res != <a name="a13"></a><a class="code" href="group__stateMachine.html#ggad29739ed2b2edf3691ea54dcf9dfa7ccaccd3847074003cb9ea9c35a9b769278f" title="A final state (any but the error state) was reached.">stateM_finalStateReached</a> )</div>
<div class="line">   {</div>
<div class="line">      fprintf( stderr, <span class="stringliteral">&quot;Unexpected return value from stateM_handleEvent:&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot; %d\n&quot;</span>, res );</div>
<div class="line">      exit( 3 );</div>
<div class="line">   }</div>
<div class="line">   puts( <span class="stringliteral">&quot;A final state was reached (as expected)&quot;</span> );</div>
<div class="line"></div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> entryAction( <span class="keywordtype">void</span> *stateData, <span class="keyword">struct</span> <a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> *<a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> )</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span> *stateName = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)stateData;</div>
<div class="line"></div>
<div class="line">   printf( <span class="stringliteral">&quot;Entering %s\n&quot;</span>, stateName );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> exitAction( <span class="keywordtype">void</span> *stateData, <span class="keyword">struct</span> <a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> *<a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> )</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span> *stateName = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)stateData;</div>
<div class="line"></div>
<div class="line">   printf( <span class="stringliteral">&quot;Exiting %s\n&quot;</span>, stateName );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> transAction( <span class="keywordtype">void</span> *oldStateData, <span class="keyword">struct</span> <a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a> *<a class="code" href="group__stateMachine.html#structevent" title="Event.">event</a>,</div>
<div class="line">      <span class="keywordtype">void</span> *newStateData )</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">struct </span>eventPayload *eventData = (<span class="keyword">struct </span>eventPayload *)event-&gt;<a name="a14"></a><a class="code" href="group__stateMachine.html#a675355462c32d49a652673799ca24209" title="Event payload.">data</a>;</div>
<div class="line"></div>
<div class="line">   printf( <span class="stringliteral">&quot;Event &#39;%c&#39;\n&quot;</span>, eventData-&gt;data );</div>
<div class="line"></div>
<div class="line">   <span class="keywordflow">if</span> ( strcmp( ( (<span class="keyword">const</span> <span class="keywordtype">char</span> *)newStateData ), eventData-&gt;expectedState ) )</div>
<div class="line">   {</div>
<div class="line">      fprintf( stderr, <span class="stringliteral">&quot;Unexpected state transition (to %s)\n&quot;</span>,</div>
<div class="line">            (<span class="keyword">const</span> <span class="keywordtype">char</span> *)newStateData );</div>
<div class="line">      exit( 1 );</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> guard( <span class="keywordtype">void</span> *condition, <span class="keyword">struct</span> event *event )</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">struct </span>eventPayload *eventData = (<span class="keyword">struct </span>eventPayload *)event-&gt;<a class="code" href="group__stateMachine.html#a675355462c32d49a652673799ca24209" title="Event payload.">data</a>;</div>
<div class="line"></div>
<div class="line">   return (intptr_t )condition == (intptr_t)eventData-&gt;data;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jul 17 2013 14:01:32 for State machine by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
